{"version":3,"sources":["src/client/index.jsx","src/client/components/App.jsx","src/client/components/Collection/index.jsx","src/client/components/Collection/Grid.jsx","src/client/components/Collection/Item/index.jsx","src/client/components/Imager.jsx","src/client/hooks/index.js","src/client/hooks/collections.js","src/client/utils/index.js","src/client/utils/fetch.js","src/client/utils/misc.js","src/client/hooks/images.js","src/client/hooks/misc.js","src/client/hooks/user.js","src/client/components/Page.jsx","src/client/components/Back.jsx","src/client/components/Collection/Item/Viewer.jsx","src/client/components/Collection/Item/Details.jsx","src/client/components/Controls/Inspect.jsx","src/client/components/User/Login.jsx"],"names":["react_1","$fsx","r","react_dom_1","App_1","default","render","createElement","document","getElementById","router_1","Collection_1","Viewer_1","Login_1","exports","className","Router","path","signup","Grid_1","Page_1","hooks_1","collectionId","collection","isLoading","useCollectionDetails","name","items","classnames_1","Item_1","console","log","length","gridScale","undefined","map","item","index","key","id","Imager_1","Link","to","width","height","alt","Image","quality","params","push","src","useImageWithPreview","join","tslib_1","__exportStar","utils_1","useCollections","collections","setCollections","useState","setIsLoading","useEffect","setTimeout","fetchJSON","then","useCollectionSlugIsAvailable","slug","isAvailable","setIsAvailable","fetchStatusIsOK","setCollection","useItemDetails","itemId","setItem","warn","fetchStatus","args","fetch","status","json","withValue","fn","target","value","previewPath","replace","setSrc","onload","usePrevious","ref","useRef","current","useUser","user","setUser","email","password","isValidating","update","Object","assign","[object Object]","updateFromInput","Back_1","_a","children","back","props","__rest","Back","navigate","onClick","Details_1","Inspect_1","react_markings_1","story","JSON","stringify","Input","onChange","type","placeholder","CollectionDetails","previousIsAvailable","c","i","somethingelse"],"mappings":"8hBAAA,MAAAA,EAAAC,EAAAC,EAAA,IACAC,EAAAF,EAAAC,EAAA,IAEAE,EAAAH,EAAAC,EAAA,IAKAD,EAAAC,EAAA,IAEAC,EAAAE,QAASC,OAAON,EAAAK,QAAAE,cAACH,EAAAC,QAAG,MAAKG,SAASC,eAAe,gFCVjD,MAAAT,EAAAC,EAAAC,EAAA,IACAQ,EAAAT,EAAAC,EAAA,GAEAS,EAAAV,EAAAC,EAAA,IACAU,EAAAX,EAAAC,EAAA,IACAW,EAAAZ,EAAAC,EAAA,IAoBAY,EAAAT,QAfY,KACVL,EAAAK,QAAAE,cAAA,OAAKQ,UAAU,gBACbf,EAAAK,QAAAE,cAACG,EAAAM,OAAM,KAELhB,EAAAK,QAAAE,cAACM,EAAAR,SAAMY,KAAK,SAASC,QAAM,IAC3BlB,EAAAK,QAAAE,cAACM,EAAAR,SAAMY,KAAK,UACZjB,EAAAK,QAAAE,cAACK,EAAAP,SAAWY,KAAK,0BACjBjB,EAAAK,QAAAE,cAACI,EAAAN,SAAgBY,KAAK,kBACtBjB,EAAAK,QAAAE,cAACI,EAAAN,SAAgBY,KAAK,MACtBjB,EAAAK,QAAAE,cAAA,OAAKF,SAAO,GAAA,6FCnBlB,MAAAL,EAAAC,EAAAC,EAAA,IACAiB,EAAAlB,EAAAC,EAAA,IACAkB,EAAAnB,EAAAC,EAAA,IACAmB,EAAApB,EAAAC,EAAA,IAEAY,EAAAT,QAAA,UAAwCiB,aAAEA,EAAe,cACvD,IAAIC,WAAEA,EAAAC,UAAYA,GAAcH,EAAAI,qBAAqBH,GAErD,OAAKC,GAAcC,EACVxB,EAAAK,QAAAE,cAAA,MAAA,KAAA,cAIPP,EAAAK,QAAAE,cAACa,EAAAf,SAAKU,UAAU,cACdf,EAAAK,QAAAE,cAAA,MAAIQ,UAAU,oBAAqBQ,EAAWG,MAE9C1B,EAAAK,QAAAE,cAACY,EAAAd,SAAKsB,MAAOJ,EAAWI,kFChB9B,MAAA3B,EAAAC,EAAAC,EAAA,IACA0B,EAAA3B,EAAAC,EAAA,GACA2B,EAAA5B,EAAAC,EAAA,IAEAY,EAAAT,QAAA,UAA6BsB,MAAEA,IAC7BG,QAAQC,IAAI,gBAAiBJ,EAAMK,QACnC,IAAIC,OAAYC,EAUhB,OARIP,EAAMK,OAAS,IACjBC,EAAY,QAGVN,EAAMK,OAAS,IACjBC,EAAY,OAIZjC,EAAAK,QAAAE,cAAA,OAAKQ,UAAWa,EAAAvB,QAAW,OAAQ4B,IAE/BN,EAAMQ,IAAI,CAACC,EAAMC,IACfrC,EAAAK,QAAAE,cAACsB,EAAAxB,SACCiC,IAAKF,EAAKG,GACVH,KAAMA,+ECtBlB,MAAApC,EAAAC,EAAAC,EAAA,IACAQ,EAAAT,EAAAC,EAAA,GACAsC,EAAAvC,EAAAC,EAAA,IAEAY,EAAAT,QAAA,UAAiC+B,KAAEA,IACjC,OACEpC,EAAAK,QAAAE,cAAA,UAAA,KACEP,EAAAK,QAAAE,cAACG,EAAA+B,MAAKC,OAAQN,EAAKE,OACjBtC,EAAAK,QAAAE,cAACiC,EAAAnC,SACCkC,GAAIH,EAAKE,IACTK,MAAO,IACPC,OAAQ,IACRC,IAAKT,EAAKV,OAEZ1B,EAAAK,QAAAE,cAAA,QAAA,KAAOP,EAAAK,QAAAE,cAAA,OAAA,KAAQ6B,EAAKV,kFCd5B,MAAA1B,EAAAC,EAAAC,EAAA,IACAmB,EAAApB,EAAAC,EAAA,IAEA,SAAwB4C,GAAMP,GAAEA,EAAAM,IAAIA,EAAAF,MAAKA,EAAAC,OAAOA,EAAAG,QAAQA,IACtD,MAAMC,KACFL,GAAOK,EAAOC,cAAcN,KAC5BC,GAAQI,EAAOC,eAAeL,KAC9BG,GAASC,EAAOC,gBAAgBF,KAEpC,MAAMG,EAAM7B,EAAA8B,0BAA0BZ,MAAOS,EAAOI,KAAK,YAEzD,OACEpD,EAAAK,QAAAE,cAAA,OAAK2C,IAAKA,EAAKL,IAAKA,IATxB/B,EAAAT,QAAAyC,EAaAhC,EAAAT,QAAeyC,0FChBfO,EAAAC,aAAArD,EAAAC,EAAA,IAAAY,GACAuC,EAAAC,aAAArD,EAAAC,EAAA,IAAAY,GACAuC,EAAAC,aAAArD,EAAAC,EAAA,IAAAY,GACAuC,EAAAC,aAAArD,EAAAC,EAAA,IAAAY,2ECHA,MAAAd,EAAAC,EAAAC,EAAA,IACAqD,EAAAtD,EAAAC,EAAA,IAEAY,EAAA0C,eAAA,WACE,IAAMC,EAAaC,GAAmB1D,EAAA2D,cAChCnC,EAAWoC,GAAiB5D,EAAA2D,UAAS,GAe3C,OAbA3D,EAAA6D,UAAU,KACR/B,QAAQC,IAAI,4BACZ6B,GAAa,GAEbE,WAAW,KACTP,EAAAQ,UAAU,oBACPC,KAAK9D,IACJwD,EAAexD,GACf0D,GAAa,aAMnBH,YAAAA,EACAjC,UAAAA,IAIJV,EAAAmD,6BAAA,SAA6CC,GAC3C,IAAMC,EAAaC,GAAmBpE,EAAA2D,UAAS,GAa/C,OAXA3D,EAAA6D,UAAU,KAGR,GAFA/B,QAAQC,IAAI,+BAAgCmC,GAExCA,EAAKlC,OAAS,EAChB,OAAOoC,GAAe,GAGxBb,EAAAc,oCAAoCH,eACjCF,KAAKI,KACNF,IAEGC,GAGTrD,EAAAW,qBAAA,SAAqCyC,GACnC,IAAM3C,EAAY+C,GAAkBtE,EAAA2D,cAASzB,IACvCV,EAAWoC,GAAiB5D,EAAA2D,UAAS,GAa3C,OAXA3D,EAAA6D,UAAU,KACR/B,QAAQC,IAAI,uBAAwBmC,GACpCN,GAAa,GAEbE,WAAW,IAAMP,EAAAQ,8BAA8BG,KAClCF,KAAK9D,IACJ0D,GAAa,GACbU,EAAcpE,QAE1BgE,KAEK3C,WAAAA,EAAYC,UAAAA,IAGvBV,EAAAyD,eAAA,UAA+BjD,aAAEA,EAAAkD,OAAcA,IAC7C,IAAMpC,EAAMqC,GAAYzE,EAAA2D,cAASzB,IAC3BV,EAAWoC,GAAiB5D,EAAA2D,UAAS,GAkB3C,OAhBA3D,EAAA6D,UAAU,KAER,GADA/B,QAAQC,IAAI,iBAAkBT,EAAckD,IACvClD,IAAiBkD,EACpB,OAAO1C,QAAQ4C,KAAK,+DAGtBd,GAAa,GAEbE,WAAW,IAAMP,EAAAQ,8BAA8BzC,WAAsBkD,KACxDR,KAAK9D,IACJ0D,GAAa,GACba,EAAQvE,KAElB,KACFoB,EAAckD,KAETpC,KAAAA,EAAMZ,UAAAA,4FCjFjB6B,EAAAC,aAAArD,EAAAC,EAAA,IAAAY,GACAuC,EAAAC,aAAArD,EAAAC,EAAA,IAAAY,0BCGA,SAAgB6D,KAAeC,GAC7B,OAAOC,SAASD,GAAMZ,KAAK9D,GAAKA,EAAE4E,yDALpChE,EAAAiD,UAAA,YAA6Ba,GAC3B,OAAOC,SAASD,GAAMZ,KAAK9D,GAAKA,EAAE6E,SAGpCjE,EAAA6D,YAAAA,EAIA7D,EAAAuD,gBAAA,YAAmCO,GACjC,OAAOD,KAAeC,GAAMZ,KAAK9D,GAAW,MAANA,4ECTxCY,EAAAkE,UAAA,SAA0BC,GACxB,MAAO,EAAGC,OAAAA,KAAaD,GAAKvD,KAAMwD,EAAOxD,KAAMyD,MAAOD,EAAOC,iFCD/D,MAAAnF,EAAAC,EAAAC,EAAA,IAEAY,EAAAqC,oBAAA,SAAoClC,GAClC,MAAMmE,EAAcnE,EAAKoE,QAAQ,qBAAsB,gBACvD,IAAMnC,EAAKoC,GAAWtF,EAAA2D,SAASyB,GAO/B,OALApF,EAAA6D,UAAU,MACI,IAAIf,OACVyC,OAASD,EAAOrE,KACpBA,IAEGiC,2ECXT,MAAAlD,EAAAC,EAAAC,EAAA,IAEAY,EAAA0E,YAAA,SAA4BL,GAC1B,MAAMM,EAAMzF,EAAA0F,SAOZ,OALA1F,EAAA6D,UAAU,KACR/B,QAAQC,IAAI,yBACZ0D,EAAIE,QAAUR,IACZA,IAEGM,EAAIE,iFCVb,MAAA3F,EAAAC,EAAAC,EAAA,IACAqD,EAAAtD,EAAAC,EAAA,IAEAY,EAAA8E,QAAA,WACE,IAAMC,EAAMC,GAAY9F,EAAA2D,UACtBoC,MAAO,GACPC,SAAU,GACV9B,KAAM,GACN+B,cAAc,IAGhB,MAAMC,EAAS,EAAGxE,KAAAA,EAAMyD,MAAAA,KAAYW,EAAOK,OAAAC,UAAMP,GAAMQ,CAAC3E,GAAOyD,KACzDmB,EAAkB/C,EAAAyB,UAAUkB,GAElC,OAASL,KAAAA,EAAMK,OAAAA,EAAQI,gBAAAA,4FCdzBtG,EAAAC,EAAAC,EAAA,IACA0B,EAAA3B,EAAAC,EAAA,GACAqG,EAAAtG,EAAAC,EAAA,IAEAY,EAAAT,QAAemG,CAAAA,QAACC,SAAEA,EAAA1F,UAAUA,EAAA2F,KAAWA,GAAIF,EAAEG,EAAAtD,EAAAuD,OAAAJ,GAAA,WAAA,YAAA,SAC3C,OACExG,EAAAK,QAAAE,cAAA,OAAKQ,UAAWa,EAAAvB,QAAW,OAAQU,IAC/B2F,GAAQ1G,EAAAK,QAAAE,cAACgG,EAAAlG,QAAI8F,OAAAC,UAAKO,IAClBF,6ECRR,MAAAzG,EAAAC,EAAAC,EAAA,IAEaY,EAAA+F,KAAO,GAAGC,SAAAA,EAAUpE,GAAAA,EAAK,UAEpC,OAAO1C,EAAAK,QAAAE,cAAA,OAAKQ,UAAU,OAAOgG,QADd,IAAMD,EAASpE,OAIhC5B,EAAAT,QAAeS,EAAA+F,6ECPf,MAAA7G,EAAAC,EAAAC,EAAA,IACAsC,EAAAvC,EAAAC,EAAA,IACA8G,EAAA/G,EAAAC,EAAA,IACAkB,EAAAnB,EAAAC,EAAA,IACAmB,EAAApB,EAAAC,EAAA,IACA+G,EAAAhH,EAAAC,EAAA,IAEAY,EAAAT,QAAA,UAAmCiB,aAAEA,EAAAkD,OAAcA,EAAAsC,SAAQA,IACzDhF,QAAQC,IAAI,aAAcT,EAAckD,GACxC,IAAIpC,KAAEA,EAAAZ,UAAMA,GAAcH,EAAAkD,gBAAiBjD,aAAAA,EAAckD,OAAAA,IAEzD,OAAKpC,GAAQZ,EACJxB,EAAAK,QAAAE,cAAA,MAAA,KAAA,cAIPP,EAAAK,QAAAE,cAACa,EAAAf,SAAKqG,MAAI,EAAC3F,UAAU,SAAS+F,SAAUA,GACtC9G,EAAAK,QAAAE,cAACiC,EAAAnC,SACCkC,GAAIjB,EAAe,IAAMc,EAAKG,GAC9BI,MAAO,MAET3C,EAAAK,QAAAE,cAACyG,EAAA3G,SAAQ+B,KAAMA,IACfpC,EAAAK,QAAAE,cAAC0G,EAAA5G,SAAQ+B,KAAMA,8ECtBrB,MAAApC,EAAAC,EAAAC,EAAA,IACAgH,EAAAjH,EAAAC,EAAA,IAGAY,EAAAT,QAAA,UAAqC+B,KAAEA,IACrC,OACEpC,EAAAK,QAAAE,cAAA,OAAKQ,UAAU,iBACbf,EAAAK,QAAAE,cAAA,KAAA,KAAM6B,EAAKV,MACX1B,EAAAK,QAAAE,cAAA,OAAKQ,UAAU,SACXmG,EAAA7G,SAAI+B,EAAK+E,mFCTnB,MAAAnH,EAAAC,EAAAC,EAAA,IAEAY,EAAAT,QAAe,GAAG+B,KAAAA,KAChBpC,EAAAK,QAAAE,cAAA,MAAA,KAAO6G,KAAKC,UAAUjF,EAAM,KAAM,6FCHpCpC,EAAAC,EAAAC,EAAA,IACAkB,EAAAnB,EAAAC,EAAA,IAEA+G,EAAAhH,EAAAC,EAAA,IAGAmB,GADApB,EAAAC,EAAA,IACAD,EAAAC,EAAA,KAgBaY,EAAAwG,MAAQd,CAAAA,QAAC9E,KAAEA,EAAAyD,MAAMA,EAAAoC,SAAOA,GAAQf,EAAEG,EAAAtD,EAAAuD,OAAAJ,GAAA,OAAA,QAAA,aAC7C,OAAAxG,EAAAK,QAAAE,cAAA,QAAA4F,OAAAC,QACEoB,KAAK,OACL9F,KAAMA,EACNyD,MAAOA,EACPsC,YAAa/F,EACb6F,SAAUA,GACNZ,MAGK7F,EAAA4G,kBAAoB,GAAGpG,aAAAA,MAClC,IAAIC,WAAEA,EAAAC,UAAYA,GAAcH,EAAAI,qBAAqBH,GAErD,OAAKC,EAKHvB,EAAAK,QAAAE,cAAA,MAAA,KACEP,EAAAK,QAAAE,cAAA,KAAA,KAAMgB,EAAWG,KAAA,KAAUH,EAAWI,MAAMK,OAAA,MALvChC,EAAAK,QAAAE,cAAA,MAAA,KAAA,gBAUXO,EAAAT,QAAe,GAAGyG,SAAAA,EAAU5F,OAAAA,GAAS,MACnC,IAAI2E,KAAEA,EAAAS,gBAAMA,GAAoBjF,EAAAuE,WAC5BnC,YAAEA,EAAAjC,UAAaA,GAAcH,EAAAmC,iBAC7BW,EAAc9C,EAAA4C,6BAA6B4B,EAAK3B,MAChDyD,EAAsBtG,EAAAmE,YAAYrB,GAEtC,OACEnE,EAAAK,QAAAE,cAACa,EAAAf,SAAKU,UAAU,4BAA4B+F,SAAUA,GAElDtF,EAAYxB,EAAAK,QAAAE,cAAA,MAAA,KAAA,cACZkD,EAAYtB,IAAI,CAACyF,EAAGC,IAClB7H,EAAAK,QAAAE,cAACO,EAAA4G,mBAAkBpF,IAAKsF,EAAE1D,KAAM5C,aAAcsG,EAAE1D,QAGpDlE,EAAAK,QAAAE,cAAC0G,EAAA5G,SAAQ+B,KAAMqB,EAAYtB,IAAIyF,GAAKA,EAAE1D,MAAO4D,eAAa,IAE1D9H,EAAAK,QAAAE,cAAA,KAAA,KAAA,QACAP,EAAAK,QAAAE,cAAC0G,EAAA5G,SAAQ+B,KAAMyD,EAAMiC,eAAa,IAElC9H,EAAAK,QAAAE,cAACO,EAAAwG,OACC5F,KAAK,QACL8F,KAAK,QACLrC,MAAOU,EAAKE,MACZwB,SAAUjB,IAGZtG,EAAAK,QAAAE,cAACO,EAAAwG,OACC5F,KAAK,WACL8F,KAAK,WACLrC,MAAOU,EAAKG,SACZuB,SAAUjB,IAGZtG,EAAAK,QAAAE,cAACO,EAAAwG,OACC5F,KAAK,OACLyD,MAAOU,EAAK3B,KACZqD,SAAUjB,IAIZtG,EAAAK,QAAAE,cAAA,KAAA,KAAA,eACE4D,EAAc,YAAc,aAE9BnE,EAAAK,QAAAE,cAAA,KAAA,KAAA,0BACEoH,EAAsB,iBAAmB","sourcesContent":["import React, { h } from 'react'\nimport ReactDom from 'react-dom'\n\nimport App from './components/App'\n// import store from './state'\n// import './utils/zoomfix'\n\n// styles\nimport './styles/base.scss'\n\nReactDom.render(<App />, document.getElementById('app'))\n","import React from 'react'\nimport { Router } from '@reach/router'\n\nimport CollectionIndex from './Collection'\nimport ItemViewer from './Collection/Item/Viewer'\nimport Login from './User/Login'\n// import CreateCollection from './Collection/CreateForm'\nimport Back from './Back'\n// import UserActions from './User/UserActions'\n\nconst App = () =>\n  <div className=\"page-content\">\n    <Router>\n      {/*<CreateCollection path=\"create-collection\" />*/}\n      <Login path=\"signup\" signup />\n      <Login path=\"login\" />\n      <ItemViewer path=\":collectionId/:itemId\" />\n      <CollectionIndex path=\":collectionId\" />\n      <CollectionIndex path=\"/\" />\n      <div default>Page not found</div>\n    </Router>\n\n    {/*<UserActions />*/}\n  </div>\n\nexport default App\n","import React from 'react'\nimport Grid from './Grid'\nimport Page from '../Page'\nimport { useCollectionDetails } from '../../hooks'\n\nexport default function ImageCollection({ collectionId = 'krwhitley' }) {\n  let { collection, isLoading } = useCollectionDetails(collectionId)\n\n  if (!collection || isLoading) {\n    return <div>Loading...</div>\n  }\n\n  return (\n    <Page className=\"collection\">\n      <h1 className=\"collection-title\">{ collection.name }</h1>\n\n      <Grid items={collection.items} />\n    </Page>\n  )\n}\n\n// export default ImageCollection\n//inject('app', 'user', 'collection', 'scroll')(observer(ImageCollection))\n\n// componentWillUnmount() {\n  //   this.props.scroll.isTracking = false\n  //   window.scrollTo(0, 0)\n  // }\n\n  // componentDidMount() {\n  //   console.log('ImageCollection:props', this.props)\n  //   let { collection, collectionId, scroll } = this.props\n\n  //   scroll.restore()\n  //   scroll.isTracking = true\n  //   collection.load(collectionId || 'krwhitley')\n  // }\n\n  // componentDidUpdate(prev) {\n  //   let { collectionId, collection } = this.props\n\n  //   if (collectionId !== prev.collectionId) {\n  //     collection.load(collectionId || 'krwhitley')\n  //   }\n  // }\n\n  // return() {\n  //   let { app, user, collection, navigate } = this.props\n  //   console.log('CollectionIndex', collection)\n\n  //   return (\n  //     <Page className=\"collection\">\n  //       {\n  //         app.editMode && user.isLoggedIn\n  //         ? <div className=\"edit-collection-details\">\n  //             <LiveEdit\n  //               className=\"h1 collection-title\"\n  //               value={collection.name}\n  //               onChange={collection.set('name')}\n  //               placeholder=\"Gallery Title\"\n  //             />\n\n  //             {\n  //               collection.isDirty && <button\n  //                 className=\"save\"\n  //                 onClick={collection.save}\n  //                 >\n  //                 Save Changes\n  //               </button>\n  //             }\n  //           </div>\n  //         : <h1 className=\"collection-title\">{ collection.name }</h1>\n  //       }\n  //       <Grid />\n  //     </Page>\n  //   )\n  // }\n","import React from 'react'\nimport classNames from 'classnames'\nimport Item from './Item'\n\nexport default function Grid({ items }) {\n  console.log('Grid rendered', items.length)\n  let gridScale = undefined\n\n  if (items.length < 8) {\n    gridScale = 'some'\n  }\n\n  if (items.length < 4) {\n    gridScale = 'few'\n  }\n\n  return (\n    <div className={classNames('grid', gridScale)}>\n      {\n        items.map((item, index) =>\n          <Item\n            key={item.id}\n            item={item}\n            />\n        )\n      }\n    </div>\n  )\n}\n","import React from 'react'\nimport { Link } from '@reach/router'\nimport Imager from '../../Imager'\n\nexport default function GridItem({ item }) {\n  return (\n    <article>\n      <Link to={`/${item.key}`}>\n        <Imager\n          id={item.key}\n          width={400}\n          height={400}\n          alt={item.name}\n          />\n        <label><span>{ item.name }</span></label>\n      </Link>\n    </article>\n  )\n}\n","import React, { Component } from 'react'\nimport { useImageWithPreview } from '../hooks'\n\nexport default function Image({ id, alt, width, height, quality }) {\n  const params = []\n  if (width) params.push(`width=${width}`)\n  if (height) params.push(`height=${height}`)\n  if (quality) params.push(`quality=${quality}`)\n\n  const src = useImageWithPreview(`/i/${id}::${params.join(',')}.jpg`)\n\n  return (\n    <img src={src} alt={alt} />\n  )\n}\n\nexport default Image\n","export * from './collections'\nexport * from './images'\nexport * from './misc'\nexport * from './user'\n","import { useState, useRef, useEffect } from 'react'\nimport { fetchJSON, fetchStatusIsOK } from '../utils'\n\nexport function useCollections() {\n  let [ collections, setCollections ] = useState([])\n  let [ isLoading, setIsLoading ] = useState(false)\n\n  useEffect(() => {\n    console.log('useCollections:useEffect')\n    setIsLoading(true)\n\n    setTimeout(() => {\n      fetchJSON('/api/collections')\n        .then(r => {\n          setCollections(r)\n          setIsLoading(false)\n        })\n    })\n  }, [])\n\n  return {\n    collections,\n    isLoading,\n  }\n}\n\nexport function useCollectionSlugIsAvailable(slug) {\n  let [ isAvailable, setIsAvailable ] = useState(false)\n\n  useEffect(() => {\n    console.log('useCollectionSlugIsAvailable', slug)\n\n    if (slug.length < 5) {\n      return setIsAvailable(false)\n    }\n\n    fetchStatusIsOK(`/api/collections/${slug}/available`)\n      .then(setIsAvailable)\n  }, [slug])\n\n  return isAvailable\n}\n\nexport function useCollectionDetails(slug) {\n  let [ collection, setCollection ] = useState(undefined)\n  let [ isLoading, setIsLoading ] = useState(false)\n\n  useEffect(() => {\n    console.log('useCollectionDetails', slug)\n    setIsLoading(true)\n\n    setTimeout(() => fetchJSON(`/api/collections/${slug}`)\n                .then(r => {\n                  setIsLoading(false)\n                  setCollection(r)\n                }))\n  }, [slug])\n\n  return { collection, isLoading }\n}\n\nexport function useItemDetails({ collectionId, itemId }) {\n  let [ item, setItem ] = useState(undefined)\n  let [ isLoading, setIsLoading ] = useState(false)\n\n  useEffect(() => {\n    console.log('useItemDetails', collectionId, itemId)\n    if (!collectionId || !itemId) {\n      return console.warn('attempting to useItemDetails without collectionId or itemId')\n    }\n\n    setIsLoading(true)\n\n    setTimeout(() => fetchJSON(`/api/collections/${collectionId}/items/${itemId}`)\n                .then(r => {\n                  setIsLoading(false)\n                  setItem(r)\n                })\n      , 0)\n  }, [collectionId, itemId])\n\n  return { item, isLoading }\n}\n","export * from './fetch'\nexport * from './misc'\n","export function fetchJSON(...args) {\n  return fetch(...args).then(r => r.json())\n}\n\nexport function fetchStatus(...args) {\n  return fetch(...args).then(r => r.status)\n}\n\nexport function fetchStatusIsOK(...args) {\n  return fetchStatus(...args).then(r => r === 200)\n}\n","export function withValue(fn) {\n  return ({ target }) => fn({ name: target.name, value: target.value })\n}\n","import { useState, useEffect } from 'react'\n\nexport function useImageWithPreview(path) {\n  const previewPath = path.replace(/^(.*)(\\.jpg|png)$/i, '$1,preview$2')\n  let [ src, setSrc ] = useState(previewPath)\n\n  useEffect(() => {\n    let image = new Image()\n    image.onload = setSrc(path)\n  }, [path])\n\n  return src\n}\n","import { useState, useRef, useEffect } from 'react'\n\nexport function usePrevious(value) {\n  const ref = useRef()\n\n  useEffect(() => {\n    console.log('usePrevious:useEffect')\n    ref.current = value\n  }, [value])\n\n  return ref.current\n}\n","import { useState, useRef, useEffect } from 'react'\nimport { fetchJSON, fetchStatusIsOK, withValue } from '../utils'\n\nexport function useUser() {\n  let [ user, setUser ] = useState({\n    email: '',\n    password: '',\n    slug: '',\n    isValidating: false,\n  })\n\n  const update = ({ name, value }) => setUser({ ...user, [name]: value })\n  const updateFromInput = withValue(update)\n\n  return { user, update, updateFromInput }\n}\n","import React from 'react'\nimport classNames from 'classnames'\nimport Back from './Back'\n\nexport default ({ children, className, back, ...props }) => {\n  return (\n    <div className={classNames('page', className)}>\n      { back && <Back {...props} /> }\n      { children }\n    </div>\n  )\n}\n","import React from 'react'\n\nexport const Back = ({ navigate, to = '../' }) => {\n  const goBack = () => navigate(to)\n  return <div className=\"back\" onClick={goBack} />\n}\n\nexport default Back\n","import React from 'react'\nimport Imager from '../../Imager'\nimport Details from './Details'\nimport Page from '../../Page'\nimport { useItemDetails } from '../../../hooks'\nimport Inspect from '../../Controls/Inspect'\n\nexport default function ItemViewer({ collectionId, itemId, navigate }) {\n  console.log('ItemViewer', collectionId, itemId)\n  let { item, isLoading } = useItemDetails({ collectionId, itemId })\n\n  if (!item || isLoading) {\n    return <div>Loading...</div>\n  }\n\n  return (\n    <Page back className=\"viewer\" navigate={navigate}>\n      <Imager\n        id={collectionId + '/' + item.id}\n        width={900}\n        />\n      <Details item={item} />\n      <Inspect item={item} />\n    </Page>\n  )\n}\n","import React from 'react'\nimport md from 'react-markings'\n// import LiveEdit from '../../Controls/LiveEdit'\n\nexport default function ImageDetails({ item }) {\n  return (\n    <div className=\"image-details\">\n      <h1>{ item.name }</h1>\n      <div className=\"story\">\n        { md([item.story]) }\n      </div>\n    </div>\n  )\n}\n\n  // <div className=\"image-details\">\n  //     {\n  //       app.editMode\n  //       ? <LiveEdit\n  //           className=\"h1 title\"\n  //           value={image.name}\n  //           onChange={image.set('name')}\n  //           placeholder=\"Give the image a title\"\n  //           />\n  //       : <h1>{ image.name }</h1>\n  //     }\n\n  //     {\n  //       app.editMode\n  //       ? <LiveEdit\n  //           className=\"story\"\n  //           value={image.story}\n  //           onChange={image.set('story')}\n  //           placeholder=\"Tell the story\"\n  //           />\n  //       : <div className=\"story\">\n  //           { md([image.story]) }\n  //         </div>\n  //     }\n\n  //     {\n  //       app.editMode && image.isDirty\n  //       ? <button\n  //           className=\"save\"\n  //           onClick={image.save}\n  //           >\n  //           Save Changes\n  //         </button>\n  //       : null\n  //     }\n  //   </div>\n  // )\n","import React from 'react'\n\nexport default ({ item }) =>\n  <pre>{ JSON.stringify(item, null, 2) }</pre>\n","import React, { useState, useRef, useEffect } from 'react'\nimport Page from '../Page'\nimport LoginForm from './LoginForm'\nimport Inspect from '../Controls/Inspect'\nimport { login } from '../../api/users'\nimport { fetchJSON, fetchStatus, fetchStatusIsOK, withValue } from '../../utils'\nimport {\n  usePrevious,\n  useCollections,\n  useCollectionSlugIsAvailable,\n  useCollectionDetails,\n  useUser,\n} from '../../hooks'\n\nconst save = (id) => (json) => fetchStatusIsOK(`/api/fake-collections/${id}`, {\n                                  method: 'POST',\n                                  headers: {\n                                    'Content-Type': 'application/json',\n                                  },\n                                  body: JSON.stringify(json),\n                                })\n\nexport const Input = ({ name, value, onChange, ...props }) =>\n  <input\n    type=\"text\"\n    name={name}\n    value={value}\n    placeholder={name}\n    onChange={onChange}\n    {...props}\n    />\n\nexport const CollectionDetails = ({ collectionId }) => {\n  let { collection, isLoading } = useCollectionDetails(collectionId)\n\n  if (!collection) {\n    return <div>Loading...</div>\n  }\n\n  return (\n    <div>\n      <h1>{ collection.name } ({ collection.items.length })</h1>\n    </div>\n  )\n}\n\nexport default ({ navigate, signup = false }) => {\n  let { user, updateFromInput } = useUser()\n  let { collections, isLoading } = useCollections()\n  let isAvailable = useCollectionSlugIsAvailable(user.slug)\n  let previousIsAvailable = usePrevious(isAvailable)\n\n  return (\n    <Page className=\"form full-page user-login\" navigate={navigate}>\n      {\n        isLoading ? <div>Loading...</div> :\n        collections.map((c, i) =>\n          <CollectionDetails key={c.slug} collectionId={c.slug} />\n        )\n      }\n      <Inspect item={collections.map(c => c.slug)} somethingelse />\n\n      <h1>User</h1>\n      <Inspect item={user} somethingelse />\n\n      <Input\n        name=\"email\"\n        type=\"email\"\n        value={user.email}\n        onChange={updateFromInput}\n        />\n\n      <Input\n        name=\"password\"\n        type=\"password\"\n        value={user.password}\n        onChange={updateFromInput}\n        />\n\n      <Input\n        name=\"slug\"\n        value={user.slug}\n        onChange={updateFromInput}\n        />\n\n\n      <h1>isAvailable</h1>\n      { isAvailable ? 'available' : 'name taken' }\n\n      <h1>isAvailable (previous)</h1>\n      { previousIsAvailable ? 'prev:available' : 'prev:name taken' }\n    </Page>\n  )\n}\n\n// export default inject('user')(observer(LoginForm))\n"]}