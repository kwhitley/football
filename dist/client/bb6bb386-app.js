!function(){if(!window.$fsx){var e=window.$fsx={};e.f={},e.m={},e.r=function(t){var l=e.m[t];if(l)return l.m.exports;var a,n=e.f[t];return n?((l=e.m[t]={}).exports={},l.m={exports:l.exports},n.call(l.exports,l.m,l.exports),null===(a=l.m.exports)||-1===["function","object","array"].indexOf(typeof a)||a.hasOwnProperty("default")||(Object.isFrozen(a)?a.default=a:Object.defineProperty(a,"default",{value:a,writable:!0,enumerable:!1})),l.m.exports):void 0}}}(),function(e){e.f[65]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(47),o=e.r(66);e.r(91),n.default.render(a.default.createElement(o.default,null),document.getElementById("app"))},e.f[66]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(0),o=e.r(67),r=e.r(84),i=e.r(86),s=e.r(88),u=e.r(89),c=e.r(90);l.default=(()=>a.default.createElement("div",{className:"page-content"},a.default.createElement(n.Router,{className:"main"},a.default.createElement(i.default,{path:"signup",signup:!0}),a.default.createElement(i.default,{path:"login"}),a.default.createElement(s.default,{path:"collections"}),a.default.createElement(u.default,{path:"collections/create"}),a.default.createElement(o.default,{path:":collectionId"}),a.default.createElement(r.default,{path:":collectionId/:itemId"}),a.default.createElement(o.default,{path:"/"}),a.default.createElement("div",{default:!0},"Page not found")),a.default.createElement(n.Router,{className:"controls",primary:!1},a.default.createElement(c.default,{default:!0}))))},e.f[67]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(68),o=e.r(82),r=e.r(71);l.default=function({collectionId:e="krwhitley"}){let{collection:t,isLoading:l}=r.useCollectionDetails(e);return!(!t||l)&&a.default.createElement(o.default,{className:"collection"},a.default.createElement("h1",{className:"collection-title"},t.name),a.default.createElement(n.default,{collectionId:e,items:t.items}))}},e.f[68]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(3),o=e.r(69);l.default=function({collectionId:e,items:t}){let l=void 0;return t.length<8&&(l="some"),t.length<4&&(l="few"),a.default.createElement("div",{className:n.default("grid",l)},t.map((t,l)=>a.default.createElement(o.default,{key:t.id,id:e+"/"+t.id,item:t})))}},e.f[69]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(0),o=e.r(70);l.default=function({item:e,id:t}){return a.default.createElement("article",null,a.default.createElement(n.Link,{to:`/${t}`},a.default.createElement(o.default,{id:t,width:400,height:400,alt:e.name}),a.default.createElement("label",null,a.default.createElement("span",null,e.name))))}},e.f[70]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(71);function o({id:e,alt:t,width:l,height:o,quality:r}){const i=[];l&&i.push(`width=${l}`),o&&i.push(`height=${o}`),r&&i.push(`quality=${r}`);const s=n.useImageWithPreview(`/i/${e}::${i.join(",")}.jpg`);return a.default.createElement("img",{src:s,alt:t})}l.default=o,l.default=o},e.f[71]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(62);a.__exportStar(e.r(72),l),a.__exportStar(e.r(77),l),a.__exportStar(e.r(78),l),a.__exportStar(e.r(79),l),a.__exportStar(e.r(80),l)},e.f[72]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(73);function o(e){let[t,l]=a.useState(!1);return a.useEffect(()=>{if(e.length<5)return l(!1);n.fetchStatusIsOK(`/api/collections/${e}/available`).then(l)},[e]),t}l.useCollections=function(){let[e,t]=a.useState([]),[l,o]=a.useState(!1);return a.useEffect(()=>{o(!0),n.fetchJSON("/api/collections").then(e=>{t(e),o(!1)})},[]),{collections:e,isLoading:l}},l.useCollectionSlugIsAvailable=o,l.useCollectionDetails=function(e){let[t,l]=a.useState(void 0),[o,r]=a.useState(!1);return a.useEffect(()=>{r(!0),n.fetchJSON(`/api/collections/${e}`).then(e=>{r(!1),l(e)})},[e]),{collection:t,isLoading:o}},l.useItemDetails=function({collectionId:e,itemId:t}){let[l,o]=a.useState(void 0),[r,i]=a.useState(!1);return a.useEffect(()=>{if(!e||!t)return console.warn("attempting to useItemDetails without collectionId or itemId");i(!0),n.fetchJSON(`/api/collections/${e}/items/${t}`).then(e=>{o(e),i(!1)})},[e,t]),{item:l,isLoading:r}},l.useNewCollection=function(){let[e,t]=a.useState(""),[l,r]=a.useState("");return{apiKey:l,setApiKey:r,slug:e,isValid:o(e),setSlug:n.withSlugifiedValue(t),isAvailable:o(e)}}},e.f[73]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(62);a.__exportStar(e.r(74),l),a.__exportStar(e.r(75),l),a.__exportStar(e.r(76),l)},e.f[74]=function(e,t){function l(...e){return fetch(...e).then(e=>e.status)}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchJSON=function(...e){return fetch(...e).then(e=>e.json())},t.fetchStatus=l,t.fetchStatusIsOK=function(...e){return l(...e).then(e=>200===e)}},e.f[75]=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.withValue=function(e){return({target:t})=>e({name:t.name,value:t.value})},t.withSlugifiedValue=function(e){return t=>e(t.toLowerCase().replace(/[^\w\.\-_]/gi,"-").replace(/\-+/gi,"-"))}},e.f[76]=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validators={email:()=>({isValid:e=>e.match(/^.+@.{2,}\..{2,}$/),message:"Please enter a valid email address"}),password:()=>({isValid:e=>e.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/),message:"Passwords should be at least 8 characters, include capital\n              and lowercase letters, and at least one number"}),collectionName:e=>({isValid:()=>e,message:"This name is invalid or has already been taken"})}},e.f[77]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52);l.useImageWithPreview=function(e){const t=e.replace(/^(.*)(\.jpg|png)$/i,"$1,preview$2");let[l,n]=a.useState(t);return a.useEffect(()=>{(new Image).onload=n(e)},[e]),l}},e.f[78]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52);l.usePrevious=function(e){const t=a.useRef();return a.useEffect(()=>{console.log("usePrevious:useEffect"),t.current=e},[e]),t.current}},e.f[79]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n="globalstore:";class o{constructor({value:e,namespace:t,persist:l}){if(this.setState=(e=>{this.state=e,this.persist&&(console.log("should persist value",e,"to namespace",n+t),localStorage.setItem(n+t,JSON.stringify(e))),this.setters.forEach(e=>e(this.state))}),this.state=e,l)try{this.state=JSON.parse(localStorage.getItem(n+t)),console.log(n+t,"found in localStorage, setting to",this.state)}catch(e){console.warn(n+t,"not found in localStorage, setting to",this.state)}this.namespace=t,this.persist=l,this.setters=[]}}l.Store=o;class r{constructor(){this.set=((e,t,l={})=>{let{persist:a}=l;this.hasOwnProperty(e)?this[e].setState(t):this[e]=new o({value:t,persist:a,namespace:e})}),this.persist=((...e)=>this.set(...e,{persist:!0}))}}l.GlobalStore=r,l.globalStore=window.globalStore=new r,l.useStore=function(e,t,n={}){let r=void 0,{persist:i}=n;r=l.globalStore.hasOwnProperty(e)?l.globalStore[e]:l.globalStore[e]=new o({value:t,persist:i,namespace:e});const[s,u]=a.useState(r.state);return r.setters.includes(u)||r.setters.push(u),a.useEffect(()=>()=>{r.setters=r.setters.filter(e=>e!==u)},[]),[s,r.setState]}},e.f[80]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(79),o=e.r(81),r=e.r(73),i=e.r(0);n.globalStore.persist("user",{isLoggedIn:!0}),r.fetchJSON("/user/profile").then(e=>{console.log("profile fetched"),n.globalStore.set("user",{isLoggedIn:!0,profile:e})}).catch(()=>{console.warn("user profile could not be found"),n.globalStore.set("user",{isLoggedIn:!1,profile:void 0})}),l.useLogin=function(e){let[t,l]=a.useState({email:"",password:"",isValidating:!1}),[r,i]=a.useState(void 0),[s,u]=n.useStore("user"),c=()=>{i(),l({email:"",password:"",isValidating:!1})};return{login:t,user:s,error:r,setLogin:({name:e,value:a})=>l(Object.assign({},t,{[e]:a})),loginAction:()=>{o.loginAction({login:t,resetLogin:c,setUser:u,setError:i,origin:e})},logoutAction:()=>{console.log("logging out"),o.logoutAction({onSuccess:()=>u({isLoggedIn:!1,profile:void 0})})}}},l.requireLogin=function(e){let[t]=n.useStore("user");return t.isLoggedIn||(console.log("user not logged in",t,"redirecting to login"),i.navigate("/login",{state:{origin:e.pathname},replace:!0})),t.isLoggedIn}},e.f[81]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(73),n=e.r(0);l.loginAction=(({login:e,resetLogin:t,setUser:l,setError:o,origin:r})=>{let{isValid:i,message:s}=a.validators.password();return e.email&&e.password?i(e.password)?void a.fetchJSON("/user/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{console.log("login success",e,r),l({isLoggedIn:!0,profile:e}),o(),t&&t(),r&&(console.log("returning to",r),n.navigate(r))}).catch(()=>{l({profile:void 0,isLoggedIn:!1}),o("Are you sure about that username and password?  Try again!")}):o(s):o("You need a username and password to login.")}),l.logoutAction=(({onSuccess:e})=>{a.fetchStatusIsOK("/user/logout").then(t=>t?e():console.warn("unable to logout"))})},e.f[82]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(62),n=e.r(52),o=e.r(3),r=e.r(83);l.default=(e=>{var{children:t,visible:l=!0,className:i,back:s}=e,u=a.__rest(e,["children","visible","className","back"]);return n.default.createElement("div",{className:o.default("page",i)},s&&n.default.createElement(r.default,Object.assign({},u)),l&&t)})},e.f[83]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52);l.Back=(({navigate:e,to:t="../"})=>{return a.default.createElement("div",{className:"back",onClick:()=>e(t)})}),l.default=l.Back},e.f[84]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(70),o=e.r(85),r=e.r(82),i=e.r(71);l.default=function({collectionId:e,itemId:t,navigate:l}){let{item:s,isLoading:u}=i.useItemDetails({collectionId:e,itemId:t});return!(!s||u)&&a.default.createElement(r.default,{back:!0,className:"viewer",navigate:l},a.default.createElement(n.default,{id:e+"/"+s.id,width:900}),a.default.createElement(o.default,{item:s}))}},e.f[85]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(51);l.default=function({item:e}){return a.default.createElement("div",{className:"image-details"},a.default.createElement("h1",null,e.name),a.default.createElement("div",{className:"story"},n.default([e.story])))}},e.f[86]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(0),o=e.r(82),r=e.r(87),i=e.r(73),s=e.r(71);l.default=function({location:e,signup:t=!1}){console.log("Login");let l=e.state&&e.state.origin||void 0,{login:u,setLogin:c,error:d,loginAction:f,logoutAction:g}=s.useLogin(l),[m]=s.useStore("user");return console.log({origin:l,user:m,login:u}),a.useEffect(()=>{console.log("Login:useEffect",m),m.isLoggedIn&&(console.log("user already logged in, redirecting to",l,e),n.navigate(l||"/"))},[u,m]),a.default.createElement(o.default,{className:"form"},a.default.createElement("h1",null,t?"Sign Up":"Login"),a.default.createElement(r.default,{name:"email",type:"email",value:u.email,validator:i.validators.email(),onChange:c}),a.default.createElement(r.default,{name:"password",type:"password",value:u.password,onChange:c,validator:i.validators.password()}),d&&a.default.createElement("div",{className:"error"},d),a.default.createElement("button",{onClick:f},"Submit"))}},e.f[87]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(62),n=e.r(52),o=e.r(3),r=e=>({target:t})=>{let{name:l,value:a}=t;return e(l?t:a)};l.default=function(e){var{name:t,value:l,onChange:i,label:s,placeholder:u,className:c,validator:d}=e,f=a.__rest(e,["name","value","onChange","label","placeholder","className","validator"]);let g=void 0,m=void 0;return d&&(m=(g=d.isValid(l)?void 0:"true")&&l&&d.message),n.default.createElement("section",{className:"input-group"},n.default.createElement("input",Object.assign({className:o.default("input",c),type:"text",name:t,value:l,invalid:g,placeholder:u||t,onChange:r(i)},f)),n.default.createElement("label",{className:m?"hint":void 0},s||u||t),d&&d.message&&n.default.createElement("b",{className:o.default("details",m&&"visible")},m))}},e.f[88]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(0),o=e.r(82),r=e.r(71);l.default=function({location:e}){let t=r.requireLogin(e),[l]=r.useStore("user");if(!t)return!1;let{collections:i}=l.profile;return a.default.createElement(o.default,{className:"form collections-list"},a.default.createElement("h1",null,"Collections"),i.map(e=>a.default.createElement(n.Link,{key:e._id,to:"/"+e.slug},e.name||e.slug)),a.default.createElement(n.Link,{className:"create",to:"create"},"Create New"))}},e.f[89]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(82),o=e.r(87),r=e.r(73),i=e.r(71);l.default=function({location:e}){let t=i.requireLogin(e),l=i.useNewCollection(),{slug:s,setSlug:u,apiKey:c,setApiKey:d,isAvailable:f,isValid:g,createCollectionAction:m}=l;return!!t&&a.default.createElement(n.default,{className:"form",visible:t},a.default.createElement("h1",null,"Create a New Collection"),a.default.createElement(o.default,{placeholder:"Collection Link (URL)",value:s,validator:r.validators.collectionName(f),onChange:u}),a.default.createElement(o.default,{placeholder:"Your API Key",value:c,onChange:d}),a.default.createElement("button",{disabled:!g,onClick:m},"Create Collection"))}},e.f[90]=function(t,l){Object.defineProperty(l,"__esModule",{value:!0});const a=e.r(52),n=e.r(0),o=e.r(71);l.default=function({location:e}){let{user:t,logoutAction:l}=o.useLogin();return e&&e.state&&e.state.origin,a.default.createElement(a.default.Fragment,null,t.isLoggedIn?a.default.createElement(a.default.Fragment,null,a.default.createElement("a",{className:"link",onClick:l},"Logout"),a.default.createElement(n.Link,{to:"/collections"},"Collections")):a.default.createElement("div",{className:"login-signup"},a.default.createElement("a",{className:"link",onClick:()=>n.navigate("/login",{state:{origin:e&&e.pathname},replace:!0})},"Login"),a.default.createElement(n.Link,{to:"/signup"},"Signup")))}},e.r(65)}($fsx);
//# sourceMappingURL=app_quantum.js.map